var __extends=this&&this.__extends||function(){var o=function(t,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var i in t)t.hasOwnProperty(i)&&(o[i]=t[i])})(t,i)};return function(t,i){function e(){this.constructor=t}o(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}(),Security;!function(o){!function(o){var t=function(){function t(t,i){this.is_active=!1,this.action_text=null,this.attr_place_order="[data-popup-login-place-order]",this.attr_fake_user_place_order="[data-popup-login-fake-user-place-order]",this.el_line=".js_login_sub_action_line",this.el_text=".js_login_sub_action_text",this.config_params=i,this.loginTForm=t,this.ACTION_TYPE_PLACE_ORDER=this.config_params.pr_login_t_login_action_type.LOGIN_ACTION_TYPE_PLACE_ORDER,this.ACTION_TYPE_FAKE_USER_PLACE_ORDER=this.config_params.pr_login_t_login_action_type.LOGIN_ACTION_TYPE_FAKE_USER_PLACE_ORDER,this.config_params.pr_login_t_is_param_login_first&&(this.config_params.pr_login_t_is_param_login_cant_register?this.openCantRegisterPopup():this.config_params.pr_login_t_is_param_login_fast_signup_customer?this.actionFastSignupCustomer():this.config_params.pr_login_t_is_param_login_fast_signup_writer?this.actionFastSignupWriter():this.actionAccessPage()),PopupMaker.onOpen("popup_login",this.proxy(this.focusInput,this)),PopupMaker.onClose("popup_login",this.proxy(this.onCloseLoginPopup,this)),$(document).on("click",this.attr_place_order,this.proxy(this.actionPlaceOrder,this)).on("click",this.attr_fake_user_place_order,this.proxy(this.actionFakeUserPlaceOrder,this)),new o.Social.Process.LoginTSocialCore(t,i.pr_login_t_social_params)}return t.prototype.actionPlaceOrder=function(){this.runAction(this.config_params.pr_login_actions_name.place_order,this.ACTION_TYPE_PLACE_ORDER,1)},t.prototype.actionFakeUserPlaceOrder=function(){this.runAction(this.config_params.pr_login_actions_name.fake_user,this.ACTION_TYPE_FAKE_USER_PLACE_ORDER,1)},t.prototype.actionAccessPage=function(){this.runAction2(this.config_params.pr_login_actions_name.access_page)},t.prototype.actionFastSignupCustomer=function(){this.runAction2(this.config_params.pr_login_actions_name.place_order,this.ACTION_TYPE_PLACE_ORDER,1)},t.prototype.actionFastSignupWriter=function(){this.runAction2(this.config_params.pr_login_actions_name.create_account)},t.prototype.runAction=function(o,t,i){this._runAction(o,t,i),this.openLoginPopup()},t.prototype.runAction2=function(o,t,i){this._runAction(o,t,i),this.openLoginPopup(!0)},t.prototype._runAction=function(o,t,i){this.is_active=!0,this.action_text=o,t&&this.setCookies(t,i),this.showSubActionText()},t.prototype.openLoginPopup=function(o){o?setTimeout(this.proxy(function(){PopupMaker.show("popup_login")},this),0):PopupMaker.show("popup_login")},t.prototype.openCantRegisterPopup=function(o){o?setTimeout(this.proxy(function(){PopupMaker.show("popup_cant_register")},this),0):PopupMaker.show("popup_cant_register")},t.prototype.onCloseLoginPopup=function(){this.is_active=!1,$(this.el_line).hide(),this.deleteCookies()},t.prototype.focusInput=function(){setTimeout(this.proxy(function(){var o=this.loginTForm.$container.find('input[type="email"], :password').filter(":visible:first");o.length&&o.focus()},this),500)},t.prototype.showSubActionText=function(){this.is_active&&($(this.el_text).text(this.action_text),$(this.el_line).show())},t.prototype.setCookies=function(o,t){CookieEditor.set(this.config_params.pr_login_t_cookie_action_type,o),CookieEditor.set(this.config_params.pr_login_t_cookie_action_value,t)},t.prototype.deleteCookies=function(){CookieEditor.del(this.config_params.pr_login_t_cookie_action_type),CookieEditor.del(this.config_params.pr_login_t_cookie_action_value)},t.prototype.proxy=function(o,t,i){var e=[].slice.call(arguments,2);return function(){return o.apply(t,e.concat([].slice.call(arguments)))}},t}();o.LoginTAction=t}(o.Login||(o.Login={}))}(Security||(Security={}));var Security;!function(o){!function(o){var t=function(){function t(t){this.containerSelector=".js_login_form_container",this.loginFormSelector=".js_login_form",this.preLoginFormSelector=".js_pre_login_form",this.loginFormWrapperSelector=".js_login_form_wrapper",this.preLoginFormWrapperSelector=".js_pre_login_form_wrapper",this.changeUserSelector=".js_login_change_user",this.loadingImgSelector=".js_login_loading_img",this.loadingHideSelector=".js_login_loading_hide",this.openForgotPopupSelector=".js_login_open_forgot_popup",this.forgotPasswordEmailSelector=".js_forgot_password_email",this.googleRecaptchaContainerSelector="#js_google_recaptcha_container",this.googleRecaptchaDataFieldSelector=".js_google_recaptcha_data_field",this.loginEmailSelector="#_pre_login_username",this.loginPasswordSelector="#_password",this.buttonPopupLoginSelector="[data-popup-click]",this.configParams=t,this.loginTAction=new o.LoginTAction(this,this.configParams),this.$container=$(this.containerSelector),this.initEventHandlers(),this.hideLoading()}return t.prototype.initEventHandlers=function(){this.$container.on("click",this.changeUserSelector,this.changeUser.bind(this)),this.$container.on("submit",this.loginFormSelector+", "+this.preLoginFormSelector,this.submit.bind(this)),this.$container.on("click",this.openForgotPopupSelector,this.openForgotPasswordPopup.bind(this)),$(document).on("click",this.buttonPopupLoginSelector,this.loginButtonClick.bind(this)),this.$container.on("click",this.loginEmailSelector,function(){return gaObjectPool.getLoginForm().eventLoginEmailFieldClick()}),this.$container.on("click",this.loginPasswordSelector,function(){return gaObjectPool.getLoginForm().eventLoginPasswordFieldClick()}),$(document).on("EVENT_GOOGLE_RECAPTCHA_LOADED",this.initGoogleCaptcha.bind(this))},t.prototype.submit=function(o){var i=this;this.showLoading(),this.trimPasswordValue();var e=$(o.target),n=e.serialize(),r=e.attr("action");return $.post(r,n,function(o){o.ajax_auth_is_success?o.ajax_auth_redirect_url?window.location.href=o.ajax_auth_redirect_url:(PopupMaker.hide("popup_login"),$(document).trigger(t.EVENT_USER_AUTHORIZED_SUCCESS,{type:t.TYPE})):o.form_content&&(i.$container.html(o.form_content),i.loginTAction.focusInput(),i.loginTAction.showSubActionText(),i.$container.find('input[type="password"]').hasClass("errorInput")?gaObjectPool.getLoginForm().eventUserAuthorizedFailurePassword():i.$container.find('input[type="email"]').hasClass("errorInput")?gaObjectPool.getLoginForm().eventUserAuthorizedFailureLogin():gaObjectPool.getLoginForm().eventUserEmailSuccess(),i.initGoogleCaptcha(),i.hideLoading())}),!1},t.prototype.showLoading=function(){$(this.loadingHideSelector).hide(),$(this.loadingImgSelector).show(),$(document).trigger(t.EVENT_SHOW_FORM_LOADING)},t.prototype.hideLoading=function(){$(this.loadingHideSelector).show(),$(this.loadingImgSelector).hide()},t.prototype.changeUser=function(){CookieEditor.del(this.configParams.pr_login_t_cookie_email),$(this.loginFormWrapperSelector).hide(),$(this.preLoginFormWrapperSelector).show(),this.getFieldEmail().each(function(o,t){$(t).val("")}),this.loginTAction.focusInput(),gaObjectPool.getLoginForm().eventChangeUser()},t.prototype.openForgotPasswordPopup=function(){var o=this.getLastEmail();o&&$(this.forgotPasswordEmailSelector).val(o),PopupMaker.hide("popup_login"),PopupMaker.show("popup_forgot_password"),gaObjectPool.getLoginForm().eventForgotPassword()},t.prototype.getLastEmail=function(){var o,t,i;return this.getFieldEmail().each(function(e,n){if(o=$(n),i=o.val(),i.length&&(t=i),o.is(":visible"))return!1}),t},t.prototype.trimPasswordValue=function(){var o=this.getFieldPassword();o.val($.trim(o.val()))},t.prototype.getFieldEmail=function(){return this.$container.find('input[type="email"]')},t.prototype.getFieldPassword=function(){return this.$container.find('input[type="password"]')},t.prototype.getLoginFormElement=function(){return this.loginFormSelector},t.prototype.getPreLoginFormElement=function(){return this.preLoginFormSelector},t.prototype.initGoogleCaptcha=function(){if($(this.googleRecaptchaContainerSelector).length){var o=$(this.googleRecaptchaDataFieldSelector),t=o.attr("data-js-recaptcha-sitekey"),i=o.attr("data-js-recaptcha-locale"),e=this.googleRecaptchaContainerSelector.substring(1,this.googleRecaptchaContainerSelector.length);grecaptcha.render(e,{sitekey:t,hl:i})}},t.prototype.loginButtonClick=function(){var o=$(this.loginFormWrapperSelector);o.length&&"none"!==o.css("display")?gaObjectPool.getLoginForm().eventLoginShowPasswordInput():gaObjectPool.getLoginForm().eventLoginShowEmailInput()},t.EVENT_USER_AUTHORIZED_SUCCESS="event_user_authorized_success",t.EVENT_SHOW_FORM_LOADING="event_show_form_loading",t.TYPE="internal",t}();o.LoginTForm=t}(o.Login||(o.Login={}))}(Security||(Security={}));var Security;!function(o){!function(o){!function(o){!function(o){var t=function(){function t(t,i){this.config_params=i,this.config_params.facebook&&new o.SocialFB(t).init(this.config_params.facebook),this.config_params.google&&new o.SocialGoogle(t).init(this.config_params.google)}return t}();o.LoginTSocialCore=t}(o.Process||(o.Process={}))}(o.Social||(o.Social={}))}(o.Login||(o.Login={}))}(Security||(Security={}));var Security;!function(o){!function(o){!function(t){!function(t){var i=function(){function t(o){var i=this;this.socialAuthErrorSelector=".js_social_auth_error_block",this.socialAuthErrorTextSelector=".js_social_auth_error_text",this.preAuthorizeUserEmailSelector=".js_pre_authorize_user_email",this.preLoginUserTypeSelector=".js_pre_login_user_type_id_for_signup",this.isButtonClicked=!1,this.loginTForm=o,t.staticInited||(window.addEventListener("message",function(o){return i.receiveMessage(o)},!1),t.staticInited=!0)}return t.prototype.onAuthSuccess=function(){},t.prototype.showLoading=function(){this.loginTForm.showLoading()},t.prototype.hideLoading=function(){this.loginTForm.hideLoading()},t.prototype.sendForLogin=function(t){var i=this;if(t.social_type_id&&t.accessToken){this.showLoading();var e=this.getUserTypeId(),n=this.getUserPreEmail(),r=this.socialParams.auth_url;$.ajax({method:"POST",url:r,data:{accessToken:t.accessToken,typeId:t.social_type_id,user_type_id:e,pre_user_email:n}}).done(function(t){t.ajax_auth_is_success?t.ajax_auth_redirect_url?window.location.href=t.ajax_auth_redirect_url:(PopupMaker.hide("popup_login"),$(document).trigger(o.LoginTForm.EVENT_USER_AUTHORIZED_SUCCESS,{type:i.getType()}),i.onAuthSuccess()):t.error?(t.social_account_id&&console.log("account_id",t.social_account_id),i.setError(t.error),i.hideLoading()):i.hideLoading(),i.isButtonClicked=!1})}},t.prototype.receiveMessage=function(o){if(o){if(o.origin!=location.origin)return;var t=null;try{t=$.parseJSON(o.data)}catch(o){console.log(o.message)}t&&this.sendForLogin(t)}},t.prototype.getUserPreEmail=function(){return $(this.preAuthorizeUserEmailSelector).is(":visible")?$(this.preAuthorizeUserEmailSelector).text():null},t.prototype.getUserTypeId=function(){var o=$(this.preLoginUserTypeSelector);return o?o.val():null},t.prototype.setError=function(o){var t=$(this.socialAuthErrorSelector);t.is(":visible")||t.show(),$(this.loginTForm.getLoginFormElement()).is(":visible")&&$(this.loginTForm.getLoginFormElement()).find(this.socialAuthErrorTextSelector).html(o),$(this.loginTForm.getPreLoginFormElement()).is(":visible")&&$(this.loginTForm.getPreLoginFormElement()).find(this.socialAuthErrorTextSelector).html(o)},t.staticInited=!1,t}();t.AbstractSocial=i}(t.Process||(t.Process={}))}(o.Social||(o.Social={}))}(o.Login||(o.Login={}))}(Security||(Security={}));var Security;!function(o){!function(o){!function(o){!function(o){var t=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.button_el=".js_facebook_login_btn",t}return __extends(t,o),t.prototype.init=function(o){this.socialParams=o,$(window).load(this.onLoad())},t.prototype.onLoad=function(){$(document).on("click",this.button_el,this.onClickButton.bind(this))},t.prototype.isCanClickBtn=function(){return!this.child_window||!!this.child_window.closed},t.prototype.getType=function(){return t.TYPE},t.prototype.onAuthSuccess=function(){gaObjectPool.getLoginForm().eventUserAuthorizedSocialFbSuccess()},t.prototype.onClickButton=function(){this.isCanClickBtn()&&(this.child_window=window.open(this.socialParams.OAuth_url,"popUpWindow","height=400,width=400,left=10,top=10,resizable=no,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,status=no"),gaObjectPool.getLoginForm().eventLoginFacebookOpenPopup())},t.TYPE="FB",t}(o.AbstractSocial);o.SocialFB=t}(o.Process||(o.Process={}))}(o.Social||(o.Social={}))}(o.Login||(o.Login={}))}(Security||(Security={}));var Security;!function(o){!function(o){!function(o){!function(o){var t=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.buttonEl=".js_google_login_btn",t}return __extends(t,o),t.prototype.init=function(o){this.socialParams=o,$(window).load(this.onLoad())},t.prototype.onLoad=function(){$(document).on("click",this.buttonEl,this.onClickButton.bind(this))},t.prototype.isCanClickBtn=function(){return!this.child_window||!!this.child_window.closed},t.prototype.getType=function(){return t.TYPE},t.prototype.onAuthSuccess=function(){gaObjectPool.getLoginForm().eventUserAuthorizedSocialGoogleSuccess()},t.prototype.onClickButton=function(){this.isCanClickBtn()&&(this.child_window=window.open(this.socialParams.OAuth_url,"popUpWindow","height=400,width=400,left=10,top=10,resizable=no,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,status=no"),gaObjectPool.getLoginForm().eventLoginGoogleOpenPopup())},t.TYPE="Google",t}(o.AbstractSocial);o.SocialGoogle=t}(o.Process||(o.Process={}))}(o.Social||(o.Social={}))}(o.Login||(o.Login={}))}(Security||(Security={}));